
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Selectors Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="TheModularManager.html" />
    
    
    <link rel="prev" href="ConfluxInjection.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Table of contents</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Philosophies.html">
            
                <a href="../Philosophies.html">
            
                    
                    Philosophies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../QuickStart.html">
            
                <a href="../QuickStart.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="FirstManager.html">
            
                <a href="FirstManager.html">
            
                    
                    First Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="TheConflux.html">
            
                <a href="TheConflux.html">
            
                    
                    The Conflux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="StoreCreation.html">
            
                <a href="StoreCreation.html">
            
                    
                    Store Creation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="Actions.html">
            
                <a href="Actions.html">
            
                    
                    Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="Reducers.html">
            
                <a href="Reducers.html">
            
                    
                    Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="ActionInterception.html">
            
                <a href="ActionInterception.html">
            
                    
                    Action Interception
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="ConfluxInjection.html">
            
                <a href="ConfluxInjection.html">
            
                    
                    Conflux Injection
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.8" data-path="Selectors.html">
            
                <a href="Selectors.html">
            
                    
                    Selectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="TheModularManager.html">
            
                <a href="TheModularManager.html">
            
                    
                    The Modular Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="HigherOrderReducers.html">
            
                <a href="HigherOrderReducers.html">
            
                    
                    Higher-Order Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="TheBigPicture.html">
            
                <a href="TheBigPicture.html">
            
                    
                    The Big Picture
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../examples/README.md">
            
                <span>
            
                    
                    Examples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../examples/ClassicTodos.md">
            
                <span>
            
                    
                    Classic Todos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../examples/RPG.md">
            
                <span>
            
                    
                    RPG
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../api/README.md">
            
                <span>
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../api/Action.md">
            
                <span>
            
                    
                    Action
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../api/Actions.md">
            
                <span>
            
                    
                    Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../api/Manage.md">
            
                <span>
            
                    
                    Manage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Selectors</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="selectors">Selectors</h1>
<p>Selectors are a common utility for computing derived state. Every good app should store the absolute minimum amount of data possible and use selectors to compute the rest of the data needed by the app.</p>
<p>While excellent third-party Redux selection libraries exist (such as <a href="https://github.com/reactjs/reselect" target="_blank">Reselect</a>), and they are completely compatible with Fluxuate, the concept is so essential to a good application that it deserved a front seat in Fluxuate&apos;s ecosystem.</p>
<p>Recall our <code>entities/weapons</code> Manager:</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Manage</span><span class="token punctuation">(</span><span class="token string">&apos;entities/weapons&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WeaponsDbManager</span> <span class="token punctuation">{</span>
    dagger <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">500</span> <span class="token punctuation">}</span>
    crossbow <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">2600</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A simple selector that computes the combined cost of all weapons would look like the following:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;fluxuate&apos;</span>

<span class="token operator">...</span>

    @<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;totalCost&apos;</span><span class="token punctuation">)</span>
    <span class="token function">selectTotalCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>weaponName <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> cost <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> state <span class="token operator">+</span> cost<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre>
<p>Looping over all entities in a collection can be an expensive task. To prevent this from running on every state update, selectors can be memoized. A memoized selector will only recalculate its value when the value of one of its dependencies changes.</p>
<p>Let&apos;s memoize our example selector:</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;totalCost&apos;</span><span class="token punctuation">)</span>
<span class="token function">selectTotalCost</span><span class="token punctuation">(</span>memoize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">(</span>
        weaponsState <span class="token operator">=</span><span class="token operator">&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>weaponsState<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>weaponName <span class="token operator">=</span><span class="token operator">&gt;</span> weaponsState<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> cost <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> state <span class="token operator">+</span> cost<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The first argument of all selectors is a function called <code>memoize</code>. We call <code>memoize()</code> with the values we want to capture. <code>memoize()</code> returns another function that accepts the selector&apos;s <code>calculator</code> function as its only argument:</p>
<pre class="language-"><code class="lang-javascript"><span class="token function">memoize</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">)</span><span class="token punctuation">(</span>calculator<span class="token punctuation">)</span>
</code></pre>
<p>The calculator function will receive the values passed to <code>memoize()</code> as arguments.</p>
<h3 id="selector-factories">Selector Factories</h3>
<p>Suppose we want to add a <code>minCost</code> filter to our <code>totalCost</code> selector.</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;totalCost&apos;</span><span class="token punctuation">)</span>
<span class="token function">selectTotalCost</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> minCost <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> minCost<span class="token punctuation">)</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>weaponsState<span class="token punctuation">,</span> minCost<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>weaponsState<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>weaponName <span class="token operator">=</span><span class="token operator">&gt;</span> weaponsState<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>weaponData <span class="token operator">=</span><span class="token operator">&gt;</span> weaponData<span class="token punctuation">.</span>cost <span class="token operator">&gt;</span> minCost<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> cost <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> state <span class="token operator">+</span> cost<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now if we use our selector multiple times, we&apos;ll lose the power of memoization:</p>
<pre class="language-"><code class="lang-javascript">weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">totalCost</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">totalCost</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// forces a recalculation</span>
weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">totalCost</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// oops! Also forces a recalculation</span>
</code></pre>
<p>Sometimes we want to use a memoized selector for several different values at once. Since a selector recalculates its value every time one of its inputs changes, the successive calls to the selector will force a recalculation. To accomplish this, we can use a selector factory.</p>
<p>Any selector that returns a function becomes a selector factory. Every time a selector factory is called, it essentially creates a new selector.</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;totalCost&apos;</span><span class="token punctuation">)</span>
<span class="token function">selectTotalCost</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> minCost <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> minCost<span class="token punctuation">)</span><span class="token punctuation">(</span>
        weaponsState <span class="token operator">=</span><span class="token operator">&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>weaponsState<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>weaponName <span class="token operator">=</span><span class="token operator">&gt;</span> weaponsState<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>weaponData <span class="token operator">=</span><span class="token operator">&gt;</span> weaponData<span class="token punctuation">.</span>cost <span class="token operator">&gt;</span> minCost<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> cost <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> state <span class="token operator">+</span> cost<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now we can use it:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">let</span> lowCostSelector <span class="token operator">=</span> weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">totalCost</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> highCostSelector <span class="token operator">=</span> weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">totalCost</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token function">lowCostSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">highCostSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">lowCostSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="lets-use-this-thing">Let&apos;s Use This Thing</h3>
<p>To find the cost of a weapon, we&apos;ve been using the following code:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">let</span> weaponData <span class="token operator">=</span> weaponsDb<span class="token punctuation">.</span>state<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span>
<span class="token keyword">let</span> weaponCost <span class="token operator">=</span> weaponData <span class="token operator">&amp;&amp;</span> weaponData<span class="token punctuation">.</span>cost
</code></pre>
<p>Let&apos;s create a selector on the <code>entities/weapons</code> Manager that does this for us:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Manage<span class="token punctuation">,</span> Select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;fluxuate&apos;</span>

@<span class="token function">Manage</span><span class="token punctuation">(</span><span class="token string">&apos;entities/weapons&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WeaponsDbManager</span> <span class="token punctuation">{</span>
    dagger <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">500</span> <span class="token punctuation">}</span>
    crossbow <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">2600</span> <span class="token punctuation">}</span>

    @<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;cost&apos;</span><span class="token punctuation">)</span>
    <span class="token function">selectCost</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> weaponName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> weaponData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span>
        <span class="token keyword">return</span> weaponData <span class="token operator">&amp;&amp;</span> weaponData<span class="token punctuation">.</span>cost
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To make our app more declarative, let&apos;s create another selector that just grabs a weapon&apos;s data:</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Manage</span><span class="token punctuation">(</span><span class="token string">&apos;entities/weapons&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WeaponsDbManager</span> <span class="token punctuation">{</span>
    dagger <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">500</span> <span class="token punctuation">}</span>
    crossbow <span class="token operator">=</span> <span class="token punctuation">{</span> cost<span class="token punctuation">:</span> <span class="token number">2600</span> <span class="token punctuation">}</span>

    @<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;byName&apos;</span><span class="token punctuation">)</span>
    <span class="token function">selectByName</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> weaponName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">[</span>weaponName<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    @<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;cost&apos;</span><span class="token punctuation">)</span>
    <span class="token function">selectCost</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> weaponName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">byName</span><span class="token punctuation">(</span>weaponName<span class="token punctuation">)</span><span class="token punctuation">.</span>cost <span class="token operator">||</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="confluxselect"><code>Conflux.select</code></h3>
<p>This is another property that all Confluxes have. <code>Conflux.select</code> retrieves an object containing all the selectors declared in that Conflux&apos;s Manager.</p>
<p>Let&apos;s use our new selectors:</p>
<pre class="language-"><code class="lang-javascript"><span class="token comment" spellcheck="true">// gold.js</span>
<span class="token keyword">import</span> weaponsDb <span class="token keyword">from</span> <span class="token string">&apos;./entities/weapons&apos;</span>

<span class="token operator">...</span>

    @<span class="token function">Reduce</span><span class="token punctuation">(</span><span class="token string">&apos;/weapons/buy&apos;</span><span class="token punctuation">)</span>
    <span class="token function">reduceWeaponsBuy</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> weaponName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state <span class="token operator">-</span> weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span>weaponName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    @<span class="token function">Reduce</span><span class="token punctuation">(</span><span class="token string">&apos;/weapons/sell&apos;</span><span class="token punctuation">)</span>
    <span class="token function">reduceWeaponsSell</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> weaponName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state <span class="token operator">+</span> weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span>weaponName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre>
<pre class="language-"><code class="lang-javascript"><span class="token comment" spellcheck="true">// weapons.js</span>
<span class="token keyword">import</span> weaponsDb <span class="token keyword">from</span> <span class="token string">&apos;./entities/weapons&apos;</span>
<span class="token keyword">import</span> gold <span class="token keyword">from</span> <span class="token string">&apos;./gold&apos;</span>

<span class="token operator">...</span>

    @<span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&apos;buy&apos;</span><span class="token punctuation">)</span>
    <span class="token function">hasSufficientGold</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload<span class="token punctuation">:</span>weaponName <span class="token punctuation">}</span><span class="token punctuation">,</span> proceed<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> gold<span class="token punctuation">.</span>state <span class="token operator">-</span> weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span>weaponName<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span>
            <span class="token operator">?</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You don&apos;t have enough gold to buy that weapon!`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre>
<h3 id="hassufficientgold"><code>hasSufficientGold()</code></h3>
<p>We have one more optimization we can make with selectors. We have two methods that perform the <code>hasSufficientGold</code> calculation. Let&apos;s offload this to a selector on the <code>gold</code> Manager:</p>
<pre class="language-"><code class="lang-javascript">@<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&apos;hasSufficientGold&apos;</span><span class="token punctuation">)</span>
<span class="token function">selectHasSufficientGold</span><span class="token punctuation">(</span>memoize<span class="token punctuation">,</span> costOfItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">-</span> costOfItem <span class="token operator">&gt;=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And use it:</p>
<pre class="language-"><code class="lang-javascript"><span class="token comment" spellcheck="true">// gold.js</span>
<span class="token operator">...</span>

    @<span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&apos;spend&apos;</span><span class="token punctuation">)</span>
    <span class="token function">hasSufficientGold</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> proceed<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">hasSufficientGold</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
            <span class="token operator">?</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You don&apos;t have enough gold to do that!`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre>
<pre class="language-"><code class="lang-javascript"><span class="token comment" spellcheck="true">// weapons.js</span>
<span class="token keyword">import</span> weaponsDb <span class="token keyword">from</span> <span class="token string">&apos;./entities/weapons&apos;</span>
<span class="token keyword">import</span> gold <span class="token keyword">from</span> <span class="token string">&apos;./gold&apos;</span>

<span class="token operator">...</span>

    @<span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&apos;buy&apos;</span><span class="token punctuation">)</span>
    <span class="token function">hasSufficientGold</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload<span class="token punctuation">:</span>weaponName <span class="token punctuation">}</span><span class="token punctuation">,</span> proceed<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> gold<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">hasSufficientGold</span><span class="token punctuation">(</span>weaponsDb<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span>weaponName<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You don&apos;t have enough gold to buy that weapon!`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre>
<h3 id="notes">Notes</h3>
<ul>
<li>Since memoization adds some overhead, only memoize selectors when you&apos;re sure that it might give some performance benefit. A good rule of thumb is to only memoize selectors whose algorithms are worse than O(1).</li>
</ul>
<h3 id="next-step">Next Step</h3>
<p><a href="TheModularManager.html">The Modular Manager</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ConfluxInjection.html" class="navigation navigation-prev " aria-label="Previous page: Conflux Injection">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="TheModularManager.html" class="navigation navigation-next " aria-label="Next page: The Modular Manager">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Selectors","level":"1.4.8","depth":2,"next":{"title":"The Modular Manager","level":"1.4.9","depth":2,"path":"docs/tutorial/TheModularManager.md","ref":"docs/tutorial/TheModularManager.md","articles":[]},"previous":{"title":"Conflux Injection","level":"1.4.7","depth":2,"path":"docs/tutorial/ConfluxInjection.md","ref":"docs/tutorial/ConfluxInjection.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight"],"pluginsConfig":{"prism":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"docs/styles/website.css"}},"file":{"path":"docs/tutorial/Selectors.md","mtime":"2017-10-03T17:04:05.226Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-10-03T22:00:32.344Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

